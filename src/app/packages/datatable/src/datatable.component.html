<!-- <div class="flx-datatable"> -->

    <div class="dt-options" *ngIf="templateRefs[GridTemplates.options]">
        <flx-templateLoader [templateRef]="templateRefs[GridTemplates.options]"
                            [templateCtx]="{ 'columns': cols, 'columnsMap': colsMap, 'level': level }"></flx-templateLoader>
    </div>


    <div class="dt-content" #dtContentRef [class.scrollable-horizontally]="!inheritsMetas && metas.resizeMode.value === ResizeModes.expand">
        <div class="dt-content-inner" #dtContentInnerRef [style.width]="metas.width.value">
            <div class="dt-head" #dtHeadRef *ngIf="includeHead">
                <div class="dt-head-inner">
                    <div class="dt-row">
                        <ng-container *ngFor="let col of cols; let colIndex = index">
                            <div class="dt-cell" [style.width]="col.metas.width.value" *ngIf="col.metas.visibility.value" (mousedown)="stopPropagation($event); handleColDragging($event, col)">

                                <div class="dt-cell-inner-cover" [class.active]="col.dragged"></div>

                                <ng-container *ngIf="col.templateRefs[ColumnTemplates.headCell]">
                                        <flx-templateLoader [templateRef]="col.templateRefs[ColumnTemplates.headCell]"
                                                            [templateCtx]="{ 'column': col, 'columnIndex': colIndex, 'columns': cols, 'columnsMap': colsMap, 'level': level }"></flx-templateLoader>
                                </ng-container>

                                <ng-container *ngIf="!col.templateRefs[ColumnTemplates.headCell]">
                                    <div class="dt-cell-inner">
                                        <div class="dt-col-resizer left flx-no-select" *ngIf="shouldEmbedColResizer(col, colIndex, 'left')" (mousedown)="stopPropagation($event); handleColResizing($event, colIndex, 'left')"></div>
                                        <div class="dt-col-header flx-no-select">
                                            <span title="{{col.header}}">{{col.header}}</span>
                                        </div>
                                        <div class="dt-col-sorter flx-no-select" (click)="stopPropagation($event); col.sort($event)" (mousedown)="stopPropagation($event)" *ngIf="col.sortable && !!col.field">
                                            <i *ngIf="col.metas.sortOrder.value === 1" class="material-icons arrow active">arrow_drop_up</i>
                                            <i *ngIf="col.metas.sortOrder.value === 0 || col.metas.sortOrder.value === -1" class="material-icons arrow" [class.active]="col.metas.sortOrder.value !== 0">arrow_drop_down</i>
                                        </div>
                                        <div class="dt-col-resizer right flx-no-select" *ngIf="shouldEmbedColResizer(col, colIndex, 'right')" (mousedown)="stopPropagation($event); handleColResizing($event, colIndex, 'right')"></div>
                                    </div>
                                </ng-container>
                            </div>
                        </ng-container>
                    </div>
                </div>
            </div>

            <div class="dt-body" #dtBodyRef [ngClass]="level === 0 ? 'dt-root': 'dt-nested'"  [class.in-focus]="isInFocus" [ngStyle]="bodyStyle" [flxObserveWidth]="readyToProcessData && metas.resizeMode.value !== ResizeModes.expand" (onWidthChange)="onBodyWidthChange($event)">
                <div class="dt-body-inner" [style.width]="bodyWidth" *ngIf="gridData.length">
                    <ng-container *ngFor="let rowData of renderData; let rowIndex = index; let firstRow = first; let lastRow = last;">
                        <div class="dt-row" [class.expanded]="rowData.dtExpanded">
                            <ng-container *ngFor="let col of cols; let colIndex = index">
                                <div class="dt-cell" [style.width]="col.metas.width.value" *ngIf="col.metas.visibility.value">

                                    <ng-container *ngIf="col.templateRefs[ColumnTemplates.bodyCell]">
                                        <flx-templateLoader [templateRef]="col.templateRefs[ColumnTemplates.bodyCell]"
                                                            [templateCtx]="{ 'rowData': rowData, 'rowIndex': rowIndex, 'column': col, 'columnIndex': colIndex, 'columns': cols, 'columnsMap': colsMap, 'level': level, 'toggleRow': bindFnContext(toggleRow) }"></flx-templateLoader>
                                    </ng-container>

                                    <ng-container *ngIf="!col.templateRefs[ColumnTemplates.bodyCell]">
                                        <div class="dt-cell-inner">
                                            <ng-container *ngIf="col.expander">
                                                <div class="flx-css-icon-container" [style.margin-left]="level * 30 + 'px'">
                                                    <span class="flx-chevron flx-chevron-circle flx-clickable flx-no-select" [class.flx-chevron-down]="rowData.dtExpanded" (click)="toggleRow(rowData)" *ngIf="isRowExpandable(rowData, rowIndex)"></span>
                                                </div>
                                            </ng-container>
                                            <ng-container *ngIf="!!col.field">
                                                <span *flxVar="resolveFieldValue(rowData, col.field) as resolvedFieldValue" class="dt-field-value" title="{{resolvedFieldValue}}">{{resolvedFieldValue}}</span>
                                            </ng-container>
                                        </div>
                                    </ng-container>
                                </div>
                            </ng-container>
                        </div>

                        <div class="dt-row-expanded-content-container" *ngIf="rowData.dtExpanded" [@rowExpansion]>
                            <flx-templateLoader [templateRef]="templateRefs[GridTemplates.rowExpansion]"
                                                [templateCtx]="{ 'rowData': rowData, 'rowIndex': rowIndex, 'columns': cols, 'columnsMap': colsMap, 'level': level, 'self': self }"></flx-templateLoader>
                        </div>
                    </ng-container>
                </div>

                <div class="dt-body-no-results-template-container" *ngIf="!gridData.length && templateRefs[GridTemplates.noResults]">
                    <flx-templateLoader [templateRef]="templateRefs[GridTemplates.noResults]"
                                        [templateCtx]="{ 'columns': cols, 'columnsMap': colsMap, 'level': level }"></flx-templateLoader>
                </div>
            </div>
        </div>
    </div>

    <div class="dt-paginator-container flx-no-select" *ngIf="pagination && readyToProcessData">
        <flx-paginator [itemsCount]="filteredData.length" 
                       [pageLinksSize]="pagination.pageLinksSize" 
                       [itemsPerPage]="metas.itemsPerPage.value" 
                       [itemsPerPageOptions]="pagination.itemsPerPageOptions"
                       (onPageChange)="onPageChange($event)"
                       (onItemsPerPageValueChange)="onItemsPerPageValueChange($event)"></flx-paginator>
    </div>


    <div class="dt-foot" #dtFoot *ngIf="templateRefs[GridTemplates.footer]">
        <flx-templateLoader [templateRef]="templateRefs[GridTemplates.footer]"
                            [templateCtx]="{ 'columns': cols, 'columnsMap': colsMap, 'level': level }"></flx-templateLoader>
    </div>

    <!-- <flx-contextMenu *ngIf="templateRefs[GridTemplates.headContextMenu] && dtHeadRef"
                    [hostElementRef]="dtHeadRef"
                    [templateRef]="templateRefs[GridTemplates.headContextMenu]"
                    [templateCtx]="{ 'columns': cols, 'columnsMap': colsMap }"></flx-contextMenu> -->
<!-- </div> -->
